{
  "info": {
    "name": "Construction Mini ERP API",
    "description": "API for Construction Mini ERP & Finance System",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:4000/api", "type": "string" },
    { "key": "token", "value": "", "type": "string" },
    { "key": "projectId", "value": "", "type": "string" },
    { "key": "userId", "value": "", "type": "string" },
    { "key": "adminEmail", "value": "admin@example.com", "type": "string" },
    { "key": "adminPassword", "value": "admin123", "type": "string" }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register Admin",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/auth/register", "host": ["{{baseUrl}}"], "path": ["auth", "register"] },
            "body": { "mode": "raw", "raw": "{\"name\":\"Admin User\",\"email\":\"{{adminEmail}}\",\"password\":\"{{adminPassword}}\"}" }
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["if (pm.response.code === 200) { pm.environment.set('token', pm.response.json().token); }"]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/auth/login" },
            "body": { "mode": "raw", "raw": "{\"email\":\"{{adminEmail}}\",\"password\":\"{{adminPassword}}\"}" }
          }
        }
      ]
    },
    {
      "name": "Projects",
      "item": [
        {
          "name": "List Projects",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/projects" }
          }
        },
        {
          "name": "Create Project",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["if (pm.response.code === 200) { pm.environment.set('projectId', pm.response.json().project.id); }"]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/projects" },
            "body": { "mode": "raw", "raw": "{\"name\":\"Test Project\",\"description\":\"Test project\",\"budget\":100000,\"progress\":10}" }
          }
        },
        {
          "name": "Get Project",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/projects/{{projectId}}" }
          }
        },
        {
          "name": "Update Project",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/projects/{{projectId}}" },
            "body": { "mode": "raw", "raw": "{\"progress\":50}" }
          }
        }
      ]
    },
    {
      "name": "Invoices",
      "item": [
        {
          "name": "List Invoices",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/invoices" }
          }
        },
        {
          "name": "Create Invoice",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/invoices" },
            "body": { "mode": "raw", "raw": "{\"project_id\":\"{{projectId}}\",\"amount\":5000,\"description\":\"Materials & labor\"}" }
          }
        }
      ]
    },
    {
      "name": "Dashboard",
      "item": [
        {
          "name": "Get Dashboard",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/dashboard" }
          }
        }
      ]
    },
    {
      "name": "Insights",
      "item": [
        {
          "name": "Get Project Insights",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/insights/project/{{projectId}}" }
          }
        }
      ]
    },
    {
      "name": "Users (Admin)",
      "item": [
        {
          "name": "List Users",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/users" }
          }
        },
        {
          "name": "Set User Role",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/users/{{userId}}/role" },
            "body": { "mode": "raw", "raw": "{\"role\":\"admin\"}" }
          }
        },
        {
          "name": "Delete User",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/users/{{userId}}" }
          }
        }
      ]
    },
    {
      "name": "Docs",
      "item": [
        {
          "name": "OpenAPI (Swagger)",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/docs" }
          }
        }
      ]
    }
  ]
}
